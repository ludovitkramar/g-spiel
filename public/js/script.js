let socket=io.connect("/",{path:"/gSpiel/socket.io"});var sid="",joinedPlayers={},readyPlayers={},myName="";let clientGame={players:[""],pnames:{},ppoints:{},impostersCount:0,round:0,talkTime:0,voteTime:0},clientTempC={},strings={},strings_en={join:"Join!",jinp:"Enter your name!",rdts:"Ready to start",srcr:"Players ready",srcw:"Players waiting",serr:"Server error:",stur:"'s turn!",awts:"Listen carefully, what is the hidden subject?",desc:"Your word:",ymnc:"You are the mole! Try to not get cought",yanm:"You are not the mole.",secr:"seconds remaining.",pinf:"Server info:",pyrs:"Players:",rnot:"Round:",lide:"Listen and Talk",ewem:"Everybody builds sentences with the given word as the theme.",vttm:"Voting time",wstm:"who was the mole?",etmo:"Evaluate the mole",dsms:"did the sentences made sense for the given noun?",rded:"Round ended",lswh:"Let's see what happened this round.",gend:"Game ended",cong:"congratulations to the winners!",crac:"couldn't remove active class",hadw:"had a different word.",thar:"There are",mols:"moles",thes:"There is",mole:"mole",wwtm:"Who was the mole?",ywtm:"You were the mole",tmcv:"The moles can't vote.",crvc:"couldn't remove voted class",evtm:"Evaluate the moles!",thnw:"Their noun was:",eval:"Evaluate",ssen:"'s sentences:",watm:"was the mole",tnwa:"The noun was:",toey:"The other players are evaluating your sentences.",rnum:"Round",rnue:"ended",rsta:"Round statistics",scr5:"Unacceptable",scr4:"Fair",scr3:"Good",scr2:"Very good",scr1:"Excellent",pnts:"points",psdv:"player didn't vote this mole.",eevc:"Everybody voted correctly...",pdvt:"players didn't vote this mole.",evre:"Evaluation result:",votd:"Voted:",ddvt:"Didn't vote.",wrgs:"Wrong guess",imps:"Correct guess",evad:"Evaluated:",ddev:"Didn't evaluate.",rcof:"reconnect attempt failed",vtit:"Vote:",evat:"Evaluate:",sltt:"Large text",smtt:"Medium text",sstt:"Small text",pyag:"Play again",pos1:"1st place",pos2:"2nd place",pos3:"3rd place"},strings_de={join:"Beitreten!",jinp:"Geben Sie Ihren Namen ein",rdts:"Ich bin bereit",srcr:"Bereite Spieler",srcw:"Wartende Spieler",serr:"Server-Fehlermeldung:",stur:" spricht!",awts:"Hören Sie genau hin, was ist das versteckte Thema?",desc:"Ihr Wort:",ymnc:"Sie haben das unterschiedliche Wort",yanm:"Sie haben das normale Wort",secr:"Sekunden verbleiben.",pinf:"Server-Info:",pyrs:"Spieler:",rnot:"Runde:",lide:"Sprechen und Zuhören",ewem:"Jeder bildet Sätze mit dem vorgegebenen Wort als Thema.",vttm:"Abstimmung",wstm:"Wer hatte das unterschiedliche Wort? ",etmo:"Bewerten",dsms:"Haben die Sätze einen Sinn ergeben?",rded:"Runde beendet",lswh:"Was ist in dieser Runde passiert?",gend:"Spiel beendet",cong:"Glückwunsch an die Gewinner!",crac:"couldn't remove active class",hadw:"hatte das unterschiedliches Wort.",thar:"",mols:"Spieler haben das andere Wort.",thes:"",mole:"Spieler/in hat das andere Wort.",wwtm:"Wer hatte das andere Wort?",ywtm:"Sie hatten das andere Wort",tmcv:"Sie können nicht abstimmen.",crvc:"couldn't remove voted class",evtm:"Bewerten",thnw:"Das andere Wort war:",eval:"Bewerten Sie",ssen:"s Sätze:",watm:"hatte das unterschiedliches Wort.",tnwa:"Das andere Wort war:",toey:"Die anderen Spieler werten Ihre Sätze aus.",rnum:"Runde",rnue:"ist beendet",rsta:"Rundenstatistik",scr5:"Ungenügend",scr4:"Ausreichend",scr3:"Befriedigend",scr2:"Gut",scr1:"Sehr gut",pnts:"Punkte",psdv:"Spieler/in hat nicht richtig gewählt.",eevc:"Jeder hat richtig gewählt.",pdvt:"Spieler haben nicht richtig gewählt.",evre:"Auswertungsergebnis:",votd:"Abgestimmt:",ddvt:"Hat nicht abgestimmt.",wrgs:"Falsch",imps:"Richtig",evad:"Bewertet:",ddev:"Hat nicht bewertet.",rcof:"Wiederverbindungsversuch fehlgeschlagen",vtit:"Wählen Sie:",evat:"Bewerten Sie:",sltt:"Große Schriftgröße",smtt:"Mittlere Schriftgröße",sstt:"Kleine Schriftgröße",pyag:"Erneut spielen",pos1:"1. Platz",pos2:"2. Platz",pos3:"3. Platz"};function setLang(e){switch(e){case"en":strings=strings_en,localStorage.setItem("lang",e);break;case"de":strings=strings_de,localStorage.setItem("lang",e);break;default:strings=strings_de,localStorage.setItem("lang","de");break}populateStrings()}function setTheme(e){function t(e){var t=document.createElement("link");t.href=e,t.type="text/css",t.rel="stylesheet",t.media="screen,print",document.getElementsByTagName("head")[0].appendChild(t)}switch(e){case"default":t("/gSpiel/css/default.css"),localStorage.setItem("theme","default");break;case"green":t("/gSpiel/css/green.css"),localStorage.setItem("theme","green");break;case"light":t("/gSpiel/css/light.css"),localStorage.setItem("theme","light");break;default:t("/gSpiel/css/default.css"),localStorage.setItem("theme","default");break}}setLang(localStorage.getItem("lang")),setTheme(localStorage.getItem("theme"));let votedImpArray=[],talkingColor="var(--gameTalking)",talkingColor2="var(--gameBg)",voteImpColor="var(--gameVoting)",voteImpColor2="var(--gameBg)",voteCorrectColor="var(--gameEvaluating)",voteCorrectColor2="var(--gameBgAlt)",roundStatsColor="var(--gameRoundStats)",roundStatsColor2="var(--gameBgAlt)";function setTextSize(e){window.universal.style.fontSize=`${e}%`}function sendReady(e){socket.emit("playerReady",e)}function onConnect(){hideAllScreens(),document.getElementById("joinScr").classList.remove("hidden"),document.getElementById("startGameTopBox").classList.add("hidden"),document.getElementById("startPlayersList").classList.add("hidden"),document.getElementById("joinGameFormBox").classList.remove("hidden"),document.getElementById("joinScrTopBox").style.height="100vh",document.getElementById("joinFormName").focus()}function populateStrings(){document.getElementById("joinFormButton").innerText=strings.join,document.getElementById("startReady").innerText=strings.rdts,document.getElementById("srcReady").innerText=strings.srcr,document.getElementById("srcWaiting").innerText=strings.srcw,document.getElementById("joinFormName").placeholder=strings.jinp,document.getElementById("sltt").innerText=strings.sltt,document.getElementById("smtt").innerText=strings.smtt,document.getElementById("sstt").innerText=strings.sstt,document.getElementById("esTitle").innerText=strings.gend,document.getElementById("esAgain").innerText=strings.pyag}function joinGame(){return playerName=document.forms.join.name.value,socket.emit("playerJoin",playerName),""!=playerName&&"undefined"!=typeof playerName}function joinSuccessful(){setTimeout((()=>{document.getElementById("startGameTopBox").classList.add("fadeIn"),document.getElementById("startGameTopBox").classList.remove("hidden"),document.getElementById("startReady").focus(),setTimeout((()=>{document.getElementById("startGameTopBox").classList.remove("fadeIn")}),500)}),400),setTimeout((()=>{document.getElementById("startPlayersList").classList.remove("hidden"),document.getElementById("startPlayersList").classList.add("downSwoosh"),setTimeout((()=>{document.getElementById("startPlayersList").classList.remove("downSwoosh")}),500)}),400),document.getElementById("joinGameFormBox").classList.add("hidden"),document.getElementById("joinScrTopBox").style.height="200px",setTimeout((()=>{document.getElementById("joinScrTopBox").style.transition=""}),500),myName=joinedPlayers[sid],document.getElementById("joinScr").style.overflow="auto"}function updatePlayerLists(){const e=document.getElementById("startReadyPlayers"),t=document.getElementById("startNotReadyPlayers");for(key in notReadyPlayers={},joinedPlayers)notReadyPlayers[key]=joinedPlayers[key];for(key in e.innerHTML="",readyPlayers)e.innerHTML+=`<div class="startReadyPlayer"><div></div><span>${readyPlayers[key]}</span></div>`,delete notReadyPlayers[key];for(key in t.innerHTML="",notReadyPlayers)t.innerHTML+=`<div class="startNotReadyPlayer"><div></div><span>${notReadyPlayers[key]}</span></div>`;var s=Object.keys(readyPlayers).length,n=Object.keys(joinedPlayers).length;n<3&&(n=3),document.getElementById("startProportion").innerHTML=s+"/"+n}function gameStateUpdate(){myName=clientGame.pnames[sid],playerListDiv=document.getElementById("gamePlayersBox");var e=`<div class="gamePlayerBoxTitle">${strings.pyrs} </div><div class="gamePlayerBoxGrid">`;for(key in playerListArray=[],clientGame.pnames)playerListArray.push(clientGame.pnames[key]);for(key in playerListArray.sort(),playerListArray)e+=`<div class="gamePlayersBoxPlayer">${playerListArray[key]}</div>`;e+="</div>",playerListDiv.innerHTML=e,document.getElementById("gameRoundCounter").innerHTML=`${strings.rnot} ${clientGame.round} / ${clientGame.players.length}`}function hideAllScreens(){document.getElementById("joinScr").classList.add("hidden"),document.getElementById("gameScr").classList.add("hidden"),document.getElementById("endScr").classList.add("hidden")}function hideGameRight(){document.getElementById("gameRoundStatsBox").classList.add("hidden"),document.getElementById("gamePlayersBox").classList.add("hidden"),document.getElementById("gameVoteImposterBox").classList.add("hidden"),document.getElementById("gameVoteCorrectnesBox").classList.add("hidden")}function changeStateText(e){var t=document.getElementById("gameStateTitle"),s=document.getElementById("gameStateSubtitle");t.classList.add("fadeFlash"),s.classList.add("fadeFlash"),setTimeout((()=>{t.innerHTML=e[0],s.innerHTML=e[1]}),300),setTimeout((()=>{t.classList.remove("fadeFlash"),s.classList.remove("fadeFlash")}),1e3)}function changeStateColor(e){document.getElementById("gameInfoBox").style.backgroundColor=e[0],document.getElementById("gameScr").style.backgroundColor=e[1]}function noticeNewPhase(e){const t=document.getElementById("phaseChangeNotice"),s=document.getElementById("phaseNoticeDialogueBox");function n(e){t.classList.remove("hidden"),t.classList.add("fadeIn"),setTimeout((()=>{s.classList.add("openZoom"),s.classList.remove("hidden")}),120),setTimeout((()=>{t.classList.remove("fadeIn"),s.classList.remove("openZoom")}),500),document.getElementById("phaseTitle").innerHTML=e[0],document.getElementById("phaseText").innerHTML=e[1],setTimeout((()=>{s.classList.add("closeZoom"),setTimeout((()=>{t.classList.add("fadeOut")}),100)}),2700),setTimeout((()=>{t.classList.add("hidden"),s.classList.add("hidden"),t.classList.remove("fadeOut"),s.classList.remove("closeZoom")}),3e3)}switch(changeStateText(["",""]),hideGameRight(),e){case"j":n(["Join the game!","choose a name and click Join!"]);break;case"s":n(["Are you ready?","everybody needs to confirm they are ready before the game starts."]);break;case"t":n([strings.lide,strings.ewem]);break;case"v":n([strings.vttm,strings.wstm]);break;case"e":n([strings.etmo,strings.dsms]);break;case"r":n([strings.rded,strings.lswh]);break;case"f":n([strings.gend,strings.cong]);break;default:n(e);break}}document.getElementById("esAgain").addEventListener("click",(function(){return window.location.reload(),!1})),socket.on("connect",(()=>{sid=socket.id,attemptReconnect(),onConnect()})),socket.on("connectionIDs",(e=>{})),socket.on("gameRunningError",(e=>{showNotification(e,"error")})),socket.on("joinPlayersNames",(e=>{joinedPlayers=e,updatePlayerLists()})),socket.on("joinSuccessful",(e=>{joinSuccessful()})),socket.on("readyPlayers",(e=>{readyPlayers=e,updatePlayerLists()})),socket.on("startGame",(e=>{startGame()})),socket.on("gameStateUpdate",(e=>{clientGame=e,gameStateUpdate()})),socket.on("gamePlayerTalking",(e=>{changeStateText([`${e}${strings.stur}`,`${strings.awts}`]),gameHighlightActivePlayer(e),changeStateColor([talkingColor,talkingColor2])})),socket.on("gameImposterWord",(e=>{changeStateText([`${strings.desc} ${e}`,`${strings.ymnc}`]),gameHighlightActivePlayer(myName),changeStateColor([talkingColor,talkingColor2])})),socket.on("gameNormalWord",(e=>{changeStateText([`${strings.desc} ${e}`,`${strings.yanm}`]),changeStateColor([talkingColor,talkingColor2]),gameHighlightActivePlayer(myName)})),socket.on("gameVoteImposter",(e=>{startVoteImposter(e)})),socket.on("gameEndVoteImposter",(e=>{endVoteImposter()})),socket.on("gameVoteCorrectnes",(e=>{startEvaluation(e)})),socket.on("gameEndVoteCorrectnes",(e=>{endEvaluation()})),socket.on("gameRoundStats",(e=>{showRoundStats(e)})),socket.on("gameRoundStatsEnd",(e=>{endRoundStats()})),socket.on("gameNewPhase",(e=>{noticeNewPhase(e)})),socket.on("gameRemainingSecs",(e=>{document.getElementById("gameRemainingTimeDisplay").innerHTML=`${e} ${strings.secr}`})),socket.on("endGame",(e=>{hideAllScreens(),showEnd(e)})),socket.on("sMsg",(e=>{showNotification(e,"info")})),document.getElementById("startReady").onclick=function(){sendReady(sid)},function(e){document.querySelector("head").appendChild(document.createElement("style"));var t=document.styleSheets[document.styleSheets.length-1];t.insertRule("* {}",0),e.universal=t.cssRules[0]}(window);let notCounter=0;function showNotification(e,t){function s(e){setTimeout((()=>{setTimeout((()=>{document.getElementById(e).remove()}),1e3),document.getElementById(e).classList.add("slowFadeOut")}),5e3)}switch(notCounter+=1,notBox=document.getElementById("notificationsBox"),t){case"error":notBox.innerHTML+=`<div class="notifyError" id="notification${notCounter}">\n                                    <i class="fa fa-times-circle" aria-hidden="true"></i>\n                                    <span>${e}</span> \n                                </div>`,s(`notification${notCounter}`);break;case"info":notBox.innerHTML+=`<div class="notifyInfo" id="notification${notCounter}">\n                                    <i class="fa fa-info-circle" aria-hidden="true"></i>\n                                    <span>${e}</span> \n                                </div>`,s(`notification${notCounter}`);break;default:break}}function startGame(){hideAllScreens(),document.getElementById("gameScr").classList.remove("hidden"),changeStateColor([talkingColor,talkingColor2]),localStorage.setItem("gameID",sid)}function gameHighlightActivePlayer(e){var t=document.getElementsByClassName("gamePlayersBoxPlayer");for(key in document.getElementById("gamePlayersBox").classList.remove("hidden"),t)if(t[key].innerHTML==e)t[key].classList.add("gamePlayerActive");else try{t[key].classList.remove("gamePlayerActive")}catch(e){}hideGameRight(),document.getElementById("gamePlayersBox").classList.remove("hidden")}function startVoteImposter(e){votedImpArray=[];var t=document.getElementById("gameVoteImposterBox");if(t.innerHTML="",-1==e.indexOf(sid)){for(key in playerListArray=[],clientGame.pnames)playerListArray.push(clientGame.pnames[key]);playerListArray.sort();var n=0,a=`<div class="gameGreyLineTitle">${strings.vtit}</div>`;for(key in playerListArray)for(s in clientGame.pnames)clientGame.pnames[s]==playerListArray[key]&&playerListArray[key]!=myName&&(a+=`<button id="vib${s}" onclick="voteImposter('${s}')" style="--ani-order: ${n+=1};">${playerListArray[key]} ${strings.hadw}</button>`);t.innerHTML+=a;var r="";r=clientGame.impostersCount>1?`${strings.thar} ${clientGame.impostersCount} ${strings.mols}`:`${strings.thes} ${clientGame.impostersCount} ${strings.mole}`,changeStateText([`${strings.wwtm}`,r])}else changeStateText([`${strings.ywtm}`,`${strings.tmcv}`]);hideGameRight(),t.classList.remove("hidden"),changeStateColor([voteImpColor,voteImpColor2])}function voteImposter(e){for(e in socket.emit("voteImposter",e),votedImpArray.length<clientGame.impostersCount?votedImpArray.push(e):(votedImpArray.push(e),votedImpArray.shift()),votedImpArray)document.getElementById(`vib${votedImpArray[e]}`).classList.add("voted");var t=[...clientGame.players];for(key in votedImpArray)t.splice(t.indexOf(votedImpArray[key]),1);for(e in t)try{document.getElementById(`vib${t[e]}`).classList.remove("voted")}catch(e){}}function endVoteImposter(){document.getElementById("gameVoteImposterBox").innerHTML=""}function startEvaluation(e){clientTempC={};var t=document.getElementById("gameVoteCorrectnesBox");if(htmlCode="",-1==e[0].indexOf(sid))if(htmlCode+=`<div class="gameGreyLineTitle">${strings.evat}</div>`,e[0].length>1)for(key in changeStateText([`${strings.evtm}`,`${strings.thnw} ${e[1]}`]),e[0]){for(htmlCode+=`<div class="gvcImposter" style="--ani-order: ${key+1};">`,htmlCode+=`<span>${strings.eval} ${clientGame.pnames[e[0][key]]}${strings.ssen}</span>`,htmlCode+="<div>",i=0;i<5;i++)htmlCode+=`<button id="evb,${e[0][key]},${i+1}" class="evb${i+1} evb" onclick="evaluateImposter(['${e[0][key]}',${i+1}], this)">\n                                    ${i+1}\n                                    <span>(${getScoreDescription(i+1)})</span>\n                                </button>`;htmlCode+="</div></div>"}else{for(changeStateText([`${clientGame.pnames[e[0][0]]} ${strings.watm}`,`${strings.tnwa} "${e[1]}"`]),htmlCode+='<div class="gvcImposter" style="--ani-order: 1;">',htmlCode+=`<span>${strings.eval} ${clientGame.pnames[e[0][0]]}${strings.ssen}</span>`,htmlCode+="<div>",i=0;i<5;i++)htmlCode+=`<button id="evb,${e[0][0]},${i+1}" class="evb${i+1} evb" onclick="evaluateImposter(['${e[0][0]}',${i+1}], this)">\n                                ${i+1}\n                                <span>(${getScoreDescription(i+1)})</span>\n                            </button>`;htmlCode+="</div></div>"}else changeStateText([`${strings.ywtm}`,`${strings.toey}`]);t.innerHTML=htmlCode,changeStateColor([voteCorrectColor,voteCorrectColor2]),hideGameRight(),t.classList.remove("hidden")}function evaluateImposter(e,t){for(key in socket.emit("voteCorrectnes",e),clientTempC[e[0]]=e[1],allButtons=document.getElementsByClassName("evb"),allButtons)try{allButtons[key].classList.remove("evbselected")}catch(e){}for(ik in clientTempC)document.getElementById(`evb,${ik},${clientTempC[ik]}`).classList.add("evbselected")}function endEvaluation(){document.getElementById("gameVoteCorrectnesBox").innerHTML=""}function getColorClassName(e){return e>4.3?"grsp5th":e>3.3?"grsp4th":e>2.3?"grspBronze":e>1.2?"grspSilver":"grspGold"}function getScoreDescription(e){return e>4.3?strings.scr5:e>3.3?strings.scr4:e>2.3?strings.scr3:e>1.2?strings.scr2:strings.scr1}function showRoundStats(e){const t=document.getElementById("gameRoundStatsBox");changeStateText([`${strings.rnum} ${clientGame.round} ${strings.rnue}`,`${strings.rsta}`]),hideGameRight(),t.classList.remove("hidden"),changeStateColor([roundStatsColor,roundStatsColor2]);var s="<div>";for(key in clientGame.players){var n=clientGame.players[key];if(-1!=e.imposters.indexOf(n)){var a="";a=e.noGuesses[n]+e.wronGuesses[n]==1?`${e.noGuesses[n]+e.wronGuesses[n]} ${strings.psdv}`:e.noGuesses[n]+e.wronGuesses[n]==0?`${strings.eevc}`:`${e.noGuesses[n]+e.wronGuesses[n]} ${strings.pdvt}`,s+=`\n                    <div class="grspTop">\n                        <div class="grspNameImp"><span>${clientGame.pnames[n]}</span></div>\n                        <div class="grspPoints"><span>${clientGame.ppoints[n]} ${strings.pnts}</span></div>\n                    </div>\n                    <div class="grspLeft">\n                        <span class="grspTitle">${a}</span>\n                        <br>\n                        <span class="grspTitle">${strings.evre} \n                            <span class="${getColorClassName(e.impScore[n])}">\n                                ${getScoreDescription(e.impScore[n])} \n                                <span> (${Math.round(10*e.impScore[n])/10})</span>\n                            </span>\n                        </span>\n                    </div>\n            `}else{s+=`\n                    <div class="grspTop">\n                        <div class="grspName"><span>${clientGame.pnames[n]}</span></div>\n                        <div class="grspPoints"><span>${clientGame.ppoints[n]} ${strings.pnts}</span></div>\n                    </div>\n                    <div class="grspLeft">\n                    <span class="grspTitle">${strings.votd}</span>\n                    <ul class="grspPlayersList">`;var r=e.r[n];if(void 0===r)s+=`<li>${strings.ddvt}</li>`;else for(id in r)-1==e.imposters.indexOf(r[id])?s+=`<li class="grspIncorrect">${clientGame.pnames[r[id]]} <span>${strings.wrgs}</span></li>`:s+=`<li class="grspCorrect">${clientGame.pnames[r[id]]} <span>${strings.imps}</span></li>`;s+=`</ul>\n                    <br>\n                    <span class="grspTitle">${strings.evad}</span>\n                    <ul class="grspScoreboard">`;var i=e.c[n];if(0==Object.keys(i).length)s+=`<li>${strings.ddev}</li>`;else for(id in i)s+=`<li class="${getColorClassName(i[id])}">\n                                ${getScoreDescription(i[id])}(${i[id]})\n                                <span>${clientGame.pnames[id]}</span>\n                            </li>`;s+="</ul></div>"}}s+="</div>",t.innerHTML=s}function endRoundStats(){hideGameRight()}function showEnd(e){hideAllScreens(),document.getElementById("endScr").classList.remove("hidden"),localStorage.removeItem("gameID");const t=e.ppoints;var s=[],n={};for(id in t){-1==s.indexOf(t[id])&&s.push(t[id]);try{n[t[id]].push(id)}catch(e){n[t[id]]=[],n[t[id]].push(id)}}s.sort((function(e,t){return t-e}));var a="",r="";for(key in s)if(key<3)for(ppp in n[s[key]]){a+=`<div id="es${i=1*key+1}" class="esTop" style="--ani-order: ${i};">`,a+=`<div>${strings[`pos${i}`]}</div><div>`,a+=`<span>${e.pnames[n[s[key]][ppp]]}</span>\n                          <span>${s[key]} ${strings.pnts}</span>`,a+="</div></div>"}else for(ppp in n[s[key]]){var i;r+=`<div style="--ani-order: ${i=1*key+1};"><div>${i}</div><div>`,r+=`<span>${e.pnames[n[s[key]][ppp]]}</span>\n                          <span>${s[key]} ${strings.pnts}</span>`,r+="</div></div>"}document.getElementById("esPodium").innerHTML=a,document.getElementById("esRanking").innerHTML=r}function attemptReconnect(){try{socket.emit("reconnect",localStorage.getItem("gameID",sid))}catch(e){}}function disconnect(){socket.disconnect()}